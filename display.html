<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<title>DieUhr</title>
<link href="display.css" rel="stylesheet"/>
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/clock.js"></script>
<script type="text/javascript" src="js/countdown.js"></script>
<style type="text/css">
body {
	background: gray;
}

#wrap {
	height:56.25vw;
    width: 100vw;
	position:absolute;
	left:0; right:0; top:0; bottom:0;
	font-size: 28vw;
}
</style>

</head>
<body>
	<div id="wrap">
		<div id="center">
			<div id="printUpperLine"></div>
			<div id="printLowerLine"></div>
		</div>	
	</div>
<script type="text/javascript" src="js/function.js"></script>
<script>
var local  = { };
var temp   = { };
var remote = { };

var timeoutState = "stop";
remote.countdownState = "stop";


function checkTimer() {
	if (timeoutState == "stop" && remote.onOff == "on" && remote.timeout != "inf") {
		timeoutState = "run";
		setTimeout(function() {
			temp.onOff = "off";
			sendDisplay(temp);
			timeoutState = "stop";
		}, remote.timeout * 1000);
	}
	if (remote.onOff == "off" && timeoutState == "run") {
		timeoutState = "stop";
	}
}

function checkCountdown() {
	if (remote.countdownState == "start" ) {
		temp.countdownState = "runing";
		temp.endtime = setCountdown(remote.countdown);
		//set timeout
		timeoutState = "stop";
		temp.timeout = parseInt(remote.countdown) + parseInt(remote.countdownTimeout) - 1;
		sendDisplay(temp);
		temp = { };
		checkDisplay();
	}
}


function timeloop() {
	$.ajax({
	url: "data.json",
	cache: false
	})
	.done(function(response) {
		remote = response;
		if (remote.checkOption == '1') { // handel option change
			local.preUpperLine = '';
			local.preLowerLine = '';
			temp.checkOption  = '2';
			sendDisplay(temp);
			temp = { };
		}
	})
	
	checkCountdown();
	checkTimer(); // timeout
	local.tab = 'Live';
	checkDisplay();
	setTimeout("timeloop()",1000);
};

timeloop();
</script>
</body>
</html>
