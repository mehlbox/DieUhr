<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<title>DieUhr</title>
<link href="display.css" rel="stylesheet"/>
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/clock.js"></script>
<script type="text/javascript" src="js/countdown.js"></script>
<style type="text/css">
body {
	background: gray;
}

#clock {
    height:56.25vw;
    width: 100vw;
    position:absolute;
    left:0; right:0; top:0; bottom:0;
	font-size: 28vw;
}

</style>

</head>
<body>
		<div id="clock">
			<div id="displayTime">
				<span class="the_clock">
					<span class="cl_hours"></span><span class="cl_minutes"></span><span class="cl_seconds"></span>
				</span>
			</div>
			<div id="displayText">
				<span class='the_message'>
				</span>
			</div>
			<div id="displayDate">
				<span class='the_date'>
					<span class='cl_day'></span><span class='cl_month'></span><span class='cl_year'></span>
				</span>
			</div>
		</div>	
<script type="text/javascript" src="js/function.js"></script>
<script>
var local = {
	tab:	"",
	mode:	"",
	timer:	"",
	message:"",
	onOff:  "",
	countdown: "",
	endtime:   ""
};

var temp = {
	tab:	"",
	mode:	"",
	timer:	"",
	message:"",
	onOff:  "",
	countdown: "",
	endtime:   ""
};

var remote = {
	tab:	"",
	mode:	"",
	timer:	"",
	message:"",
	onOff:  "",
	countdown: "",
	endtime:   ""
};

var timerState = "stop";
var countdownState = "stop";

function checkTimer() {
	if (timerState == "stop" && remote.onOff == "on" && remote.timer != "inf") {
		timerState = "run";
		setTimeout(function() {
			temp = remote;
			temp.onOff = "off";
			sendDisplay(temp);
			timerState = "stop";
		}, remote.timer * 1000);
	}
	if (remote.onOff == "off") {
		timerState = "stop";
	}
}

function checkCountdown() {
	if (countdownState == "stop" && remote.onOff == "on" && remote.mode == "countdown") {
		countdownState = "run";
		timerState = "stop";
		remote.timer = parseInt(remote.countdown + 3600); // set timer to turn off after one hour
		setCountdown(remote.countdown);
	}
	if (remote.onOff == "off" && countdownState == 'run') {
		countdownState = "stop";
	}
}

function timeloop() {
	local.tab = 'Live';
	getDisplay(); // ajax
	checkCountdown();
	checkTimer(); // turn off after time out (clock mode)
	setTimeout("timeloop()",1000);
};

timeloop();
</script>
</body>
</html>
