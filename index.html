<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<title>DieUhr</title>
<link href="design.css" rel="stylesheet"/>
<link href="display.css" rel="stylesheet"/>
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/clock.js"></script>
<script type="text/javascript" src="js/countdown.js"></script>
<script type="text/javascript" src="js/function.js"></script>
</head>
<body>
	<div class="onOff" style="float: right;">
		<button id="switch" type="button" ><img src="svg/OnOff.svg" alt="On/Off" /></button>
	</div>
	<!--div class="button" style="float: right; margin-right: 2vw;">
		<button id= "refresh" type="button" style="background-color:#FFFF66; "><img src="svg/refresh.svg" ></button>
	</div-->
<ul id="tab" class="tabrow">
  <li id="Vorschau"><input type="button" name="Vorschau" value="Vorschau"/></li>
  <li id="Live">    <input type="button" name="Live"     value="Live"/></li>
  <li id="Setup">   <input type="button" name="Setup"    value="Setup"/></li>
</ul>
	<div class="boxw">
	<div id="table">
		<div id="clock">
			<div id="displayTime">
				<span class="the_clock">
					<span class="cl_hours"></span><span class="cl_minutes"></span><span class="cl_seconds"></span>
				</span>
			</div>
			<div id="displayText">
				<span class='the_message'></span>
			</div>
			<div id="displayDate">
				<span class='the_date'>
					<span class='cl_day'></span><span class='cl_month'></span><span class='cl_year'></span>
				</span>
			</div>
		</div>	
	</div>
	</div>
	<div id="error">Keine Verbindung</div>
	<div class="boxw">
		<div style="float: left;">
			<select id="mode" style="width: 45vw;">
				<option value="textblock" >Uhr + Text</option>
				<option value="marquee"   >Uhr + Laufschrift</option>
				<option value="countdown" >Countdown + Text</option>
				<option value="onlytext" >Nur Text</option>
			</select>
			<select id="countdownMin" style="width: 20vw;">
				<option value="0"   >0 Min</option>
				<option value="60"  >1 Min</option>
				<option value="180" >3 Min</option>
				<option value="300" >5 Min</option>
				<option value="420" >7 Min</option>
				<option value="600" >10Min</option>
				<option value="900" >15Min</option>
				<option value="1200">20Min</option>
				<option value="1500">25Min</option>
				<option value="1800">30Min</option>
			</select>
			<select id="countdownSec" style="width: 20vw;">
				<option value="0"  >0 Sec</option>
				<option value="10" >10Sec</option>
				<option value="20" >20Sec</option>
				<option value="30" >30Sec</option>
				<option value="40" >40Sec</option>
				<option value="50" >50Sec</option>
			</select>
			<select id="symbol" style="width: 20vw;" >
				<option value="">&#10047;&#10084;</option>
				<option value="&#10047;" >&#10047;</option>
				<option value="&#10049;" >&#10049;</option>
				<option value="&#10084;" >&#10084;</option>
				<option value="&#10082;" >&#10082;</option>
				
				<option value="&#10017;" >&#10017;</option>
				<option value="&#10032;" >&#10032;</option>
				<option value="&#10038;" >&#10038;</option>
				<option value="&#10039;" >&#10039;</option>
				
				<option value="&#937;"  >&#937; </option>
				<option value="&#9986;" >&#9986;</option>
				<option value="&#9990;" >&#9990;</option>
				<option value="&#9993;" >&#9993;</option>
				
				<option value="&#10003;">&#10003;</option>
				<option value="&#10007;">&#10007;</option>
				<option value="&#8635;" >&#8635; </option>
				<option value="&#10132;">&#10132;</option>
			</select>		
		</div>
		<textarea id="message" name="message" rows="4" ></textarea>

		<div class="button" style="float: left;">
			<button id="new" type="button" style="background-color:#FFFF66;"><img src="svg/doc.svg" alt="Vorlage"/></button>
		</div>
		<div id="del" class="button" style="float: left;">
			<button type="button" style="background-color:#FFFF66;"><img src="svg/delete.svg" alt="lÃ¶schen"/></button>
		</div>
		<div id="bth">
		<div class="button" style="float: right;">
			<button id="confirm" type="button" style="background-color:#99DD55;"><img src="svg/done.svg" alt="senden"/></button>
		</div>
		<div class="button" style="float: right;">
			<button id="revert" type="button" style="background-color:#FF7755;"><img src="svg/back.svg" alt="holen"/></button>
		</div>
		</div>
	</div>
	<div id="boxSetup" style="font-size:4vw;">
		<table>
			<tr>
				<td>Text aus nach:</td>
				<td>
					<select id="timeout" style="width: 20vw;">
						<option value="60"  >1 Min</option>
						<option value="180" >3 Min</option>
						<option value="300" >5 Min</option>
						<option value="420" >7 Min</option>
						<option value="600" >10Min</option>
						<option value="600" >20Min</option>
						<option value="600" >30Min</option>
						<option value="inf" >&#8734;</option>
					</select>
				</td>
			</tr>
			<tr>
				<td>Countdown aus nach:</td>
				<td>
					<select id="countdownTimeout" style="width: 20vw;">
						<option value="60"  >1 Min</option>
						<option value="180" >3 Min</option>
						<option value="300" >5 Min</option>
						<option value="420" >7 Min</option>
						<option value="600" >10Min</option>
						<option value="600" >20Min</option>
						<option value="600" >30Min</option>
						<option value="inf" >&#8734;</option>
					</select>
				</td>
			</tr>
		</table>
	</div>
	<!--div id="debug" style="font-size: 3vw;"></div-->
<script>
$("#error").hide();
$("#bth").hide();
$(".displayText").hide();
$(".displayDate").hide();

var local = { }
var temp = { }
var remote = { }

try { 
	local = JSON.parse(getCookie('DieUhr'));
}

catch(err) {
	local = {
		tab:	"Vorschau",
		mode:	"textblock",
		timeout:"300",
		message:"Das Lied Nr.: ",
		countdown: "300",
		countdownTimeout: "300"
	}
}
local.endtime = setCountdown(local.countdown);

//load

$("#message").val(local.message);
$("#timeout").val(local.timeout);
$("#countdownTimeout").val(local.countdownTimeout);
$("#mode").val(local.mode);
$("#countdownMin").val(parseInt(local.countdown/60)*60); // get just the minutes in second
$("#countdownSec").val(local.countdown%60);		// get just the seconds


function timeloop() {
	getDisplay(); // more function after ajax respond
	setTimeout("timeloop()",1000);
	$("#debug").html(JSON.stringify(local));
};
timeloop();



$("#tab input").click(function(){ // tab buttons
	local.tab = $(this).val();
	setCookie('DieUhr', JSON.stringify(local));
	checkDisplay();
});

$('#switch').click(function(){ // toggel on off switch
	$(this).addClass("grayButton");
	if (remote.onOff == 'on') {
		temp.onOff ='off';
	} else {
		temp.onOff ='on';
		temp.endtime = setCountdown(remote.countdown);
	} 
	sendDisplay(temp);
	temp = { };
	setCookie('DieUhr', JSON.stringify(local));
});

$("#mode").change(function(){ // dropdown menu mode
	local.mode = $("#mode option:selected").val();
	$("#countdownMin").val(parseInt(local.countdown/60)*60); // get just the minutes in second
	$("#countdownSec").val(local.countdown%60);		// get just the seconds
	local.endtime = setCountdown(local.countdown);
	setCookie('DieUhr', JSON.stringify(local));
	checkDisplay();
});

$("#timeout").change(function(){ // dropdown menu timeout
	local.timeout = $( "#timeout option:selected" ).val();
	setCookie('DieUhr', JSON.stringify(local));
	checkDisplay();
});

$("#countdownTimeout").change(function(){ // dropdown menu countdownTimeout
	local.countdownTimeout = $( "#countdownTimeout option:selected" ).val();
	setCookie('DieUhr', JSON.stringify(local));
	checkDisplay();
});

$("#symbol").change(function(){ // dropdown menu symbol
	local.message = $("#message").val() + $( "#symbol option:selected" ).val();
	$("#symbol option:selected").prop("selected", false)
	$("#symbol option[value='']").prop("selected", true)
	$("#message").val(local.message);
	setCookie('DieUhr', JSON.stringify(local));
	checkDisplay();
});

$("#countdownMin").change(function(){ // dropdown menu countdown minute
	local.countdown = parseInt($( "#countdownMin option:selected" ).val()) + parseInt($( "#countdownSec option:selected" ).val());
	local.endtime = setCountdown(local.countdown);
	setCookie('DieUhr', JSON.stringify(local));
	checkDisplay();
});

$("#countdownSec").change(function(){ // dropdown menu countdown second
	local.countdown = parseInt($( "#countdownMin option:selected" ).val()) + parseInt($( "#countdownSec option:selected" ).val());
	local.endtime = setCountdown(local.countdown);
	setCookie('DieUhr', JSON.stringify(local));
	checkDisplay();
});


$('#message').bind('keyup',function(){ // textarea
	local.message = $("#message").val();
	setCookie('DieUhr', JSON.stringify(local));
});

$('#new').click(function(){ // template button
	local.message = "Das Lied Nr.: ";
	$("#message").val(local.message);
	setCookie('DieUhr', JSON.stringify(local));
	checkDisplay();
});

$('#del').click(function(){ // trash button
	local.message = "";
	$("#message").val(local.message);
	setCookie('DieUhr', JSON.stringify(local));
	checkDisplay();
});

$("#confirm").click(function(){ //confirm button
	$(this).addClass("grayButton");
	temp.mode      = local.mode
	temp.timeout   = local.timeout
	temp.countdownTimeout = local.countdownTimeout
	temp.message   = local.message
	temp.countdown = local.countdown
	temp.endtime   = setCountdown(local.countdown);
	if (remote.onOff == 'off') {
		temp.onOff ='on';
		temp.endtime = setCountdown(remote.countdown);
	} 
	sendDisplay(temp);
	temp = { };
	local.tab = 'Live';
	setCookie('DieUhr', JSON.stringify(local));
	checkDisplay();
});

$("#revert").click(function(){ //revert button
	$(this).addClass("grayButton");
	$.ajax({
	url: "data.json",
	cache: false
	})
	.done(function(response) {
		$("#revert").removeClass("grayButton");
		local = response;
		local.tab = 'Vorschau';
		$("#message").val(local.message);
		$("#timeout").val(local.timeout);
		$("#countdownTimeout").val(local.countdownTimeout);
		$("#mode").val(local.mode);
		$("#countdownMin").val(parseInt(local.countdown/60)*60); // get just the minutes in second
		$("#countdownSec").val(local.countdown%60);		// get just the seconds
		setCookie('DieUhr', JSON.stringify(local));
		checkDisplay();
	});
});
</script>
</body>
</html>
